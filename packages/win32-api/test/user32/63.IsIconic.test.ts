import assert from 'node:assert/strict'
import { spawn } from 'node:child_process'

import { fileShortPath } from '@waiting/shared-core'
import { sleep } from 'zx'

import { user32FindWindowEx } from '../../src/index.fun.js'
import { calcLpszWindow } from '../config.unittest.js'
import { user32, destroyWin, assertsHwnd } from '../helper.js'


describe(fileShortPath(import.meta.url), () => {
  it('IsIconic()', async () => {
    const child = spawn('calc.exe')
    await sleep(1500)

    const hWnd = await user32FindWindowEx(0, 0, null, calcLpszWindow)
    assertsHwnd(hWnd)

    assert(! await user32.IsIconic(hWnd))
    await user32.ShowWindow(hWnd, 2) // minimize
    assert(await user32.IsIconic(hWnd))

    await destroyWin(hWnd)
    child.kill()
  })
})
